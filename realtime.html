<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="aparcaslogo.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Aparcas Project</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.js"></script>








    <script type="text/javascript" src="js/amq_jquery_adapter.js"></script>
    <script type="text/javascript" src="js/amq.js"></script>




    <!-- Bootstrap core CSS     -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <!-- Animation library for notifications   -->
    <link href="bower_components/bootstrap/dist/css/animate.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="bower_components/jquery/src/css/jquery-ui.css">

    <link rel="stylesheet" href="bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
    <link href="https://fonts.googleapis.com/css?family=Mitr" rel="stylesheet">




    <link href="assets/css/style.css" rel="stylesheet" />



    <style type="text/css">
        html,
        body {
            margin-left: auto;
            margin-right: auto;
            font-family: 'Mitr', sans-serif;
            margin: auto;
            padding: 0 0 0 0;
            position: relative;
            height: 100%;
            width: 100%;
        }

        table {
            border: 1px solid black;
        }

        th {
            padding: 0px 0px 0px 50px;
        }

        .modal-body {
            position: relative;
            overflow-y: auto;
            max-height: 400px;
            padding: 15px;
        }

        #legend {
            background: #FFF;
            padding: 10px;
            margin: 5px;
            font-size: 12px;
            font-family: Arial, sans-serif;
        }

        .color {
            border: 1px solid;
            height: 12px;
            width: 12px;
            margin-right: 3px;
            float: left;
        }

        .blue {
            background: #4d4dff;
        }

        .green {
            background: #4dff88;
        }

        .yellow {
            background: #ffff4d;
        }

        .orange {
            background: #ff944d;
        }

        .red {
            background: #ff4d4d;
        }

        #full-width {
            padding: 0 0 0 0;
        }
    </style>



</head>

<body>


    <header>
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <h4><strong>Air Pollution and Radioactive Contamination Analyzing System (APARCAS)</strong> &nbsp;&nbsp;</h4>

                </div>

            </div>
        </div>
    </header>


    <section class="menu-section">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <ul id="menu-top" class="nav navbar-nav navbar-right">
                        <li><a class="menu-top-active" href="realtime.html">คุณภาพอากาศแบบเรียลไทม์</a></li>
                        <li><a href="radioactive.html">ประวัติปริมาณกัมมันตรังสี</a></li>
                        <li><a href="airquality.html">ประวัติคุณภาพอากาศ</a></li>
                        <li><a href="directions.html">ค้นหาเส้นทางหลีกเลี่ยงมลพิษ</a></li>
                        <!-- <li><a href="predict.html">พยากรณ์คุณภาพอากาศ</a></li> -->
                        <li><a href="aqi.html">ดัชนีคุณภาพอากาศ</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>






    <div id="full-width" class="container-fluid">
        <div class="row">
            <div class="col-sm-12 ">
                <div id="map" style="width:100%; height:1000px;"></div>
            </div>
        </div>
    </div>
</body>




<script>
    var markers = [];

    function initMap() {



        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 7,
            center: new google.maps.LatLng(15.044938, 102.183838),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }); //end of map

      /*  var marker = new google.maps.Marker({
            position: new google.maps.LatLng(15.9443970094, 100.1210692095),
            icon: new google.maps.MarkerImage('http://maps.google.com/mapfiles/ms/icons/blue-dot.png', undefined, undefined, undefined, new google.maps.Size(50, 50)),
            map: map,
            title: "Hello World!"
        });*/


        var amq = org.activemq.Amq;
        amq.init({
            uri: 'amq',
            logging: true
            //timeout: 20
        });

        var myHandler = {
            rcvMessage: function(message) {
                jsonObj = JSON.parse(message.textContent);
                console.log("message2: " + JSON.stringify(jsonObj));
                var mID;
                var mLat;
                var mLng;
                var mCO;
                var mNO2;
                var mO3;
                var mSO2;
                var mPM25;
                var mRadio;
                mID = eval(jsonObj.id);
                mLat = jsonObj.lat;
                mLng = jsonObj.lon;
                mCO = eval(jsonObj.co);
                mNO2 = eval(jsonObj.no2);
                mO3 = eval(jsonObj.o3);
                mSO2 = eval(jsonObj.so2);
                mPM25 = eval(jsonObj.pm25);
                mRadio = jsonObj.rad;
                mTime = jsonObj.tstamp;
                UpdateMap(mID, mLat, mLng, mCO, mNO2, mO3, mSO2, mPM25, mRadio, mTime);

            },
            myId: 'test0',
            myDestination: 'topic://aparcas_conv'
        };

        amq.addListener(myHandler.myId, myHandler.myDestination, myHandler.rcvMessage);



        function UpdateMap(id, Lat, Lng, CO, NO2, O3, SO2, PM25, Radio, Time) {
            console.log("UpdateMap()");
            CO = CO.toFixed(2);
            NO2 = NO2.toFixed(2);
            O3 = O3.toFixed(2);
            SO2 = SO2.toFixed(2);
            PM25 = PM25.toFixed(2);
            Radio = Radio.toFixed(2);

            //  console.log("showData: id: " + id + " first_name: " + first_name + " last_name: " + last_name + " Lat: " + Lat + " Lng: " + Lng + " CO: " + CO + " NO2: " + NO2 + " O3: " + O3 + " SO2: " + SO2 + " PM25: " + PM25 + " Radio: " + Radio);

            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(Lat, Lng),
                map: map,
                icon: new google.maps.MarkerImage('http://maps.google.com/mapfiles/ms/icons/blue-dot.png'),
                title: "Hello World!"
            });

            markers.push(marker);

            var infoWindow = new google.maps.InfoWindow({
                content: "<div class = 'text-primary'><b>การแจ้งเตือนปริมาณกัมมันตรังสี</b></div>" +
                    "<div class = 'text-muted'>เวลาอัพเดทล่าสุด " + Time + "</div>" +
                    "<div class = 'text-info'>ไอดีผู้ใช้: " + id + "</div>" +
                    "<div class = 'text-info'>CO: " + CO + "</div>" +
                    "<div class = 'text-info'>NO2: " + NO2 + "</div>" +
                    "<div class = 'text-info'>O3: " + O3 + "</div>" +
                    "<div class = 'text-info'>SO2: " + SO2 + "</div>" +
                    "<div class = 'text-info'>PM2.5: " + PM25 + "</div>" +
                    "<div class = 'text-info'>ค่ากัมมันตรังสี: " + Radio + "</div>",

                maxWidth: 500
            });
            marker.addListener('click', function() {
                infoWindow.open(map, marker);
            });

        }




    }
</script>

<script src="bower_components/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
<script src="bower_components/bootstrap/dist/js/bootstrap-notify.js"></script>
<script src="bower_components/bootstrap-waitingfor/build/bootstrap-waitingfor.js"></script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWgbWYxPgHHo-PU4IuhjjZhjh1PXfhYkc&callback=initMap" type="text/javascript"></script>

<script>
    function setMapOnAll(map) {
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(map);
        }
    }

    function displayTime() {
        var str = "";

        var currentTime = new Date()
        var hours = currentTime.getHours()
        var minutes = currentTime.getMinutes()
        var seconds = currentTime.getSeconds()

        if (minutes < 10) {
            minutes = "0" + minutes
        }
        if (seconds < 10) {
            seconds = "0" + seconds
        }
        str += hours + ":" + minutes + ":" + seconds + " ";
        if (hours > 11) {
            str += "PM"
        } else {
            str += "AM"
        }
        return str;
    }
</script>

</html>
