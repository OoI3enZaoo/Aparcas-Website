<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="aparcaslogo.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Aparcas Project</title>
    <!--   Core JS Files   -->



    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.js"></script>
    <script src="bower_components/jQuery-ui-Slider-Pips/dist/jquery-ui-slider-pips.js"></script>
    <script type="text/javascript" src="bower_components/moment/min/moment.min.js"></script>
    <script type="text/javascript" src="bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>







    <link href="assets/css/style.css" rel="stylesheet" />

    <link rel="stylesheet" href="bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />





    <link rel="stylesheet" href="bower_components/jquery/src/css/jquery-ui.css">


    <link href="bower_components/jQuery-ui-Slider-Pips/dist/jquery-ui-slider-pips.css" rel="stylesheet" />
    <!-- Bootstrap core CSS     -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <!-- Animation library for notifications   -->
    <link href="bower_components/bootstrap/dist/css/animate.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Mitr" rel="stylesheet">




    <style>
        html,
        body {
            margin-left: auto;
            margin-right: auto;
            font-family: 'Mitr', sans-serif;
            margin: auto;
            position: relative;
            padding: 0 0 0 0;
            height: 100%;
            width: 100%;
        }

        #map {
            position: relative;
            width: 100%;
            height: 75vh;
            margin: 0;
            padding: 0;
        }
    </style>

    <style type="text/css">
        .ui-state-focus,
        .ui-widget-content .ui-state-focus,
        .ui-widget-header .ui-state-focus,
        .ui-state-hover,
        .ui-widget-content .ui-state-hover,
        .ui-widget-header .ui-state-hover,
        .ui-state-default,
        .ui-widget-content .ui-state-default,
        .ui-widget-header .ui-state-default {
            background: #2b2b2b;
            border-color: transparent;
        }

        .ui-slider .ui-slider-pip-initial-1 .ui-slider-label {
            color: #E80949;
        }

        .ui-slider .ui-slider-pip-initial-2 .ui-slider-label {
            color: #920AFF;
        }

        #legend {
            background: #FFF;
            padding: 10px;
            margin: 5px;
            font-size: 12px;
            font-family: Arial, sans-serif;
        }

        .color {
            border: 1px solid;
            height: 12px;
            width: 12px;
            margin-right: 3px;
            float: left;
        }

        .blue {
            background: #4d4dff;
        }

        .green {
            background: #4dff88;
        }

        .yellow {
            background: #ffff4d;
        }

        .orange {
            background: #ff944d;
        }

        .red {
            background: #ff4d4d;
        }

        #full-width {
            padding: 0 0 0 0;
        }
    </style>

</head>

<body>




    <header>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12">
                    <h4><strong>Air Pollution and Radioactive Contamination Analyzing System (APARCAS)</strong> &nbsp;&nbsp;</h4>

                </div>

            </div>
        </div>
    </header>
    <section class="menu-section">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">

                    <ul id="menu-top" class="nav navbar-nav navbar-right">
                        <li><a href="realtime.html">คุณภาพอากาศแบบเรียลไทม์</a></li>
                        <li><a class="menu-top-active" href="radioactive.html">ประวัติปริมาณกัมมันตรังสี</a></li>
                        <li><a href="airquality.html">ประวัติคุณภาพอากาศ</a></li>
                        <li><a href="directions.html">ค้นหาเส้นทางหลีกเลี่ยงมลพิษ</a></li>
                        <!-- <li><a href="predict.html">พยากรณ์คุณภาพอากาศ</a></li> -->
                        <li><a href="aqi.html">ดัชนีคุณภาพอากาศ</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>






    <div id="full-width" class="container-fluid">
        <div class="row">
            <div class="col-sm-7">
                <div class="container-fluid">
                    <br>
                    <h4 class="title text-center text-info">เลื่อนที่แถบเพื่อเลือกเวลา</h4>
                    <div id="flat-slider"></div>
                </div>
                <br>
                <div id="map"></div>

            </div>
            <div class="col-sm-5">
                <br><br><br><br><br><br>


                <h4 class="text-center text-primary">กรุณาเลือกพื้นที่และวันที่เพื่อแสดงข้อมูล</h4>


                <from>
                    <div class="form-group">
                        <h5 class=" col-sm-1 col-sm-offset-2 text-info">จังหวัด:</h5>
                        <div class="col-sm-6 ">

                            <div class="dropdown">
                                <button id="pname" class="btn btn-info dropdown-toggle" style="width: 100%;  font-size:14px " type="button" data-toggle="dropdown">
                          <span class="caret"></span></button>
                                <ul id="dropdownP" class="dropdown-menu" role="menu" style="width: 356px">
                                    <!-- <li selected="selected"><a href='#' data-value='10'>กรุงเทพมหานคร</a></li> -->
                                </ul>
                            </div>


                        </div>
                    </div>
                    <br><br><br>
                    <div class="form-group">
                        <h5 class="col-sm-1 col-sm-offset-2 text-info">เขต:</h5>
                        <div class="col-sm-6">
                            <div class="dropdown">
                                <button id="dname" class="btn btn-info dropdown-toggle" style="width: 100%;  font-size:14px " type="button" data-toggle="dropdown">คลิ๊กที่นี่ เพื่อเลือกเขต
                            <span class="caret"></span></button>
                                <ul id="dropdownD" class="dropdown-menu" style="width: 356px">


                                </ul>

                            </div>
                        </div>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div class="form-group">
                        <h5 class="col-sm-1  col-sm-offset-2 text-info">แขวง:</h5>
                        <div class="col-sm-6">
                            <div class="dropdown">
                                <button id="sname" class="btn btn-info dropdown-toggle" style="width: 100%;  font-size:14px " type="button" data-toggle="dropdown">คลิ๊กที่นี่ เพื่อเลือกแขวง
                              <span class="caret"></span></button>
                                <ul id="dropdownS" class="dropdown-menu" style="width: 356px">


                                </ul>

                            </div>
                        </div>
                    </div>

                    <br><br>
                    <br>
                    <div class="form-group">
                        <h5 class="col-sm-1 col-sm-offset-2 text-info">วัน:</h5>
                        <div class="col-sm-6">
                            <!-- <input class="form-control" id="txtDate" placeholder="Pick your Date"/> -->
                            <input id="txtDate" type='text' class="form-control" placeholder="คลิ๊กที่นี่เพื่อเลือกวัน" style="width: 100%;" />
                        </div>
                    </div>
                    <br>
                    <br>
                    <br>
                    <div class="form-group col-sm-offset-3">

                        <div class="col-sm-4">
                            <button type="button" id="Search" class="btn btn-lg btn-success btn-block">แสดงข้อมูล</button>
                        </div>

                        <div class="col-sm-4">
                            <button id="clear" type="button" class="btn btn-lg btn-danger btn-block">ล้าง</button>
                        </div>

                    </div>
                    </form>

                    <br>
                    <br>

                    <!--<div class="header">

                    <div class="title col-sm-offset-3" id="aqi"></div>
                  </div>-->








            </div>

        </div>
    </div>









</body>




<script type="text/javascript" charset="utf-8">
    var datemaster;
    var countzoom = true;
    var Circles = [];

    var markers = [];

    var AllsID = [];
    var AllDID = [];

    $(".dropdown-menu li a").click(function() { // show value when click
        $(this).parents(".dropdown").find('.btn').html($(this).text());
        $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
    });


    //dname
    function initMap() {

        var myDate;
        var myStartTime = "00:00:00";
        var myEndTime = "23:00:00";
        var mDate = document.getElementById("txtDate").value;
        myDate = DatePickResponse(mDate);
        var firsttime = true;
        setDataOnMap(myStartTime, myEndTime, myDate);

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 11,
            center:

                new google.maps.LatLng(13.756331, 100.501765),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });



        $("#myGas").click(function() {

            var txt = document.getElementById("txtDate").value;

            if (txt == "") {
                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> Please select your date first");
            }

            $(".dropdown-menu li a").click(function() { // show value when click
                $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
                $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
                var mName = $(this).text();
                var mIndex = $(this).data('value');
                RemoveMarker();
                setDataOnMap(myStartTime, myEndTime, myDate);

            });


        });





        var mTimeShow = ["00:00", "", "", "03:00:", "", "", "06:00", "", "", "09:00", "", "", "12:00", "", "", "15:00", "", "", "18:00", "", "", "21:00", "", ""];
        var mTimeData = ["00:00", "01:00", "02:00", "03:00:", "04:00", "05:00", "06:00", "07:00", "08:00", "09:00", "10:00", "1:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"];

        $("#flat-slider")

            .slider({

                range: true,
                min: 1,
                max: 24,
                values: [1, 24],
                step: 1
            })

            .slider("pips", {

                first: "label",
                last: "label",
                rest: "label",
                step: 1,
                labels: mTimeShow,
                prefix: "",
                suffix: ""

            })
            .slider("float", {

                handle: false,
                pips: false,
                labels: mTimeShow,
                prefix: "",
                suffix: ""

            })
            .on("slidechange", function(e, ui) {


                var startTime = ui.values[0];
                var endTime = ui.values[1];
                $("#outputDate").text("You selected " + mTimeData[startTime - 1] + " to " + mTimeData[endTime - 1]);
                RemoveMarker();
                myStartTime = mTimeData[startTime - 1];
                myEndTime = mTimeData[endTime - 1];
                setDataOnMap(myStartTime, myEndTime, datemaster);



            });

        $("#Search").click(function() {

            //$("#showInfo").empty();


            var mDate = document.getElementById("txtDate").value;
            var dname = document.getElementById("dname").value;
            var sname = document.getElementById("sname").value;
            var pname = document.getElementById("pname").value;

            if (pname == "") {
                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> กรุณาเลือกจังหวัด");
            } else if (dname == "" && pname != "") {
                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> กรุณาเลือกเขต");
            } else if (sname == "" && pname != "" && dname != "") {
                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> กรุณาเลือกแขวง");
            } else if (mDate == "" && pname != "" && sname != "" && dname != "") {
                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> กรุณาเลือกวัน");
            } else {

                myDate = DatePickResponse(mDate);
                RemoveMarker();

                setDataOnMap(myStartTime, myEndTime, myDate);
                console.log("mDate: " + mDate);
                //$("#showInfo").append("<div class='col-md-12'><h5 class = 'text-info text-center'>ค้นหาเขต: " + myDate + "</h5></div>");


            }


        });


        function setDataOnMap(startTime, endTime, date) {

            waitingDialog.show('Get data from database...');
            setMarkerAll(null);
            markers = [];


            console.log("setDataOnMap(" + startTime + "," + endTime + "," + date + ")");


            /*var mStartTime = Date.parse(startTime);
            var mEndTime = Date.parse(endTime);
            console.log("StartTime: " + mStartTime + " EndTime: " + mEndTime); */

            datemaster = date;
            var myLocation = [];
            var myGas = [];
            var myDateTime = [];
            var check = false;
            var did = document.getElementById("dname").value; //เขต
            var sid = document.getElementById("sname").value; //แขวง
            var dname = document.getElementById("dname").innerHTML;
            var sname = document.getElementById("sname").innerHTML;
            console.log("Dname: " + dname + " did: " + did);

            $.getJSON("http://sysnet.utcc.ac.th/aparcas/api/LastDateInRecord.jsp", function(res) {
                    if (firsttime == true) {
                        date = res[0].mTime;
                        console.log("Time: " + date);


                        var year = date.substr(0, 4);
                        var month = date.substr(5, 2);
                        var day = date.substr(8, 2);
                        var formatDate = day + "/" + month + "/" + year;
                        $("#txtDate").val(formatDate);
                        firsttime = false;
                        datemaster = date;
                    }

                    if (did != 2222 && sid != 2222) {
                        var grids = "";

                        for (i = 0; i < AllsID.length; i++) {
                            console.log("AllsID: " + AllsID[i]);
                            grids += "&grids=" + AllsID[i] + "";
                        }
                        JSONString = "http://sysnet.utcc.ac.th/aparcas/api/event_trans.jsp?date=" + mDate + "&grid=" + grids + "";
                    }
                    if (did == 2222 && sid == 2222) {
                        JSONString = "http://sysnet.utcc.ac.th/aparcas/api/event_trans.jsp?date=" + date + "";
                    }
                    if (sid == 2222 && did != 2222) {
                        var grids = "";
                        for (i = 0; i < AllDID.length; i++) {
                            console.log("AllDID: " + AllDID[i]);
                            grids += "&grids=" + AllDID[i] + "";
                        }
                        JSONString = "http://sysnet.utcc.ac.th/aparcas/api/event_trans.jsp?date=" + mDate + grids + "";
                        test = 3;
                    }
                    $.getJSON(JSONString, function(result) {
                        console.log("JSON: " + JSONString);
                        if (sid != 2222 && did != 2222) { // เลือกแขวง
                            for (i = 0; i < result.length; i++) {

                                var day = moment.unix(result[i].timestamp).format("YYYY-MM-DD HH:mm:ss");
                                var restime = day;
                                res1 = restime.substr(11, 2);
                                res2 = restime.substr(14, 2);
                                res3 = restime.substr(17, 2);
                                restime = res1 + ":" + res2 + ":" + res3;

                                if (restime >= startTime && restime <= endTime) {
                                    var mID = result[i].id;
                                    var mLat = result[i].lat;
                                    var mLong = result[i].lon;

                                    var radio = result[i].radio;



                                    myLocation[i] = [mLat, mLong, mID];
                                    myGas[i] = [radio];
                                    myDateTime[i] = [day];
                                    check = true;


                                    placeMarker(myLocation[i], myGas[i], myDateTime[i]); //call method for create circle on the map
                                }


                            } //for
                            if (check == false) {
                                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> ไม่พบข้อมูล");
                            } else {
                                var geocoder = new google.maps.Geocoder();
                                geocoder.geocode({
                                    'address': sname
                                }, function(results, status) {
                                    if (status == google.maps.GeocoderStatus.OK) {
                                        map.setCenter(results[0].geometry.location);
                                        map.setZoom(13);
                                    }
                                });
                            }
                        }
                        if (sid == 2222 & did != 2222) { // sid 2222 mean all Sub_CODE (แขวงทั้งหมด)
                            console.log("do in AllsID");
                            for (i = 0; i < result.length; i++) {

                                var day = moment.unix(result[i].timestamp).format("YYYY-MM-DD HH:mm:ss");
                                var restime = day;
                                res1 = restime.substr(11, 2);
                                res2 = restime.substr(14, 2);
                                res3 = restime.substr(17, 2);
                                restime = res1 + ":" + res2 + ":" + res3;

                                if (restime >= startTime && restime <= endTime) {

                                    var mID = result[i].id;
                                    var mLat = result[i].lat;
                                    var mLong = result[i].lon;

                                    var radio = result[i].radio;
                                    myLocation[i] = [mLat, mLong, mID];
                                    myGas[i] = [radio];
                                    myDateTime[i] = [day];
                                    check = true;
                                    placeMarker(myLocation[i], myGas[i], myDateTime[i]); //call method for create circle on the map


                                }

                            }
                            if (check == false) {
                                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> ไม่พบข้อมูล");
                            } else {
                                var geocoder = new google.maps.Geocoder();
                                geocoder.geocode({
                                    'address': dname
                                }, function(results, status) {
                                    if (status == google.maps.GeocoderStatus.OK) {
                                        map.setCenter(results[0].geometry.location);
                                        map.setZoom(12);
                                    }
                                });

                            }
                        }

                        if (did == 2222 && sid == 2222) {
                            console.log("All district ");
                            console.log("All district : " + result.length);
                            for (i = 0; i < result.length; i++) {
                                var day = moment.unix(result[i].timestamp).format("YYYY-MM-DD HH:mm:ss");
                                var restime = day;
                                res1 = restime.substr(11, 2);
                                res2 = restime.substr(14, 2);
                                res3 = restime.substr(17, 2);
                                restime = res1 + ":" + res2 + ":" + res3;



                                if (restime >= startTime && restime <= endTime) {
                                    var mID = result[i].id;
                                    var mLat = result[i].lat;
                                    var mLong = result[i].lon;

                                    var radio = result[i].radio;

                                    myLocation[i] = [mLat, mLong, mID];
                                    myGas[i] = [radio];
                                    myDateTime[i] = [day];
                                    check = true;
                                    placeMarker(myLocation[i], myGas[i], myDateTime[i], result[i].grid_id); //call method for create circle on the map

                                }

                            }
                            if (check == false) {
                                getNotification("pe-7s-close-circle", "danger", "<b>Error</b> ไม่พบข้อมูล");
                            } else {
                                // var geocoder = new google.maps.Geocoder();
                                // geocoder.geocode({ 'address': 'กรุงเทพมหานคร' }, function (results, status) {
                                //   if (status == google.maps.GeocoderStatus.OK) {
                                map.setCenter(new google.maps.LatLng(13.756331, 100.501765)); //bangkok
                                map.setZoom(11);
                                //   }
                                // });

                            }

                        }

                        console.log("SID: " + sid + " DID: " + did);

                        waitingDialog.message("Set data to map...");

                        function placeMarker(mValue, mGas, mDateTime, grid_id) {

                            console.log("placeMarker");
                            // var covered = {
                            //   strokeColor: getStrokeColor(mGas[type]),//ขอบ
                            //   strokeOpacity: 0.8,
                            //   strokeWeight: 2,
                            //   fillColor: getfillColor(mGas[type]),//พื้น
                            //   fillOpacity: 0.35,
                            //   map: map,
                            //   center: new google.maps.LatLng(mValue[0], mValue[1]),
                            //   radius: 500
                            // };
                            //
                            // // Add the circle for this city to the map.
                            // var circle = new google.maps.Circle(covered);//Circles



                            $.getJSON("http://sysnet.utcc.ac.th/aparcas/api/getdistrict.jsp?data=sd&grid_id=" + grid_id+ "", function(DSName) {
                                    console.log("benL" + JSON.stringify(DSName));




                                    var marker = new google.maps.Marker({
                                        position: new google.maps.LatLng(mValue[0], mValue[1]),
                                        map: map,
                                        icon: new google.maps.MarkerImage(getColorMarker(mGas[0]), undefined, undefined, undefined, new google.maps.Size(40, 40)),
                                        title: "Hello World!"
                                    });

                                    markers.push(marker);

                                    var infoWindow = new google.maps.InfoWindow({
                                        content: "<div class = 'text-primary'><b>การแจ้งเตือนปริมาณกัมมันตรังสี</b></div>" +
                                            "<div class = 'text-muted'>เวลาอัพเดทล่าสุด " + mDateTime[0] + "</div>" +
                                            "<div class = 'text-info'>" + DSName[0].dname + "</div>" +
                                            "<div class = 'text-info'>" + DSName[0].sname + "</div>" +
                                            "<div class = 'text-info'>ไอดีผู้ใช้: " + mValue[2] + "</div>" +
                                            "<div class = 'text-info'>ค่ากัมมันตรังสี: " + mGas[0] + "</div>",

                                        maxWidth: 500
                                    });
                                    marker.addListener('click', function() {
                                        infoWindow.open(map, marker);
                                    });





                                    if (countzoom == true) {

                                        var province = document.getElementById("dname").innerHTML;
                                        console.log("Province: " + province);
                                        var geocoder = new google.maps.Geocoder();

                                        geocoder.geocode({
                                            'address': province
                                        }, function(results, status) {
                                            if (status == google.maps.GeocoderStatus.OK) {
                                                map.setCenter(results[0].geometry.location);
                                                map.setZoom(9);
                                            }
                                        });
                                    }



                                    countzoom = false;

});
                                } //placeMarker(loc)



                                $("button").click(function() {
                                    console.log("Detail Button");
                                });

                                setTimeout(function() {
                                    waitingDialog.hide();
                                }, 1000);



                            }); // json
                    }); // json

                }

                /*var legend = document.createElement('div');
                legend.id = 'legend';
                var content = [];
                content.push('<h4>Air Quality Index</h4>');
                content.push('<h5><div class="color blue"></div>0 - 50   Good</h5>');
                content.push('<h5><div class="color green"></div>51 - 100     Moderate</h5>');
                content.push('<h5><div class="color yellow"></div>100 - 200 Unhealthy for Sensitive Groups</h5>');
                content.push('<h5><div class="color orange"></div>201 - 300 Unhealthy</h5>');
                content.push('<h5><div class="color red"></div>300+ Very Unhealty</h5>');
                legend.innerHTML = content.join('');
                legend.index = 1;*/
                //map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);


                // $("#aqi").append(legend.innerHTML)




            } //init map

            var mResult = "";




            $(function() {


                $('#txtDate').datetimepicker({
                    format: 'DD/MM/YYYY'
                });
                $("#pname").text("กรุงเทพมหานคร");
                document.getElementById("pname").value = "10";
                $("#dname").text("เขตทั้งหมด");
                document.getElementById("dname").value = "2222";
                $("#sname").text("แขวงทั้งหมด");
                document.getElementById("sname").value = "2222";
                /*$.getJSON("http://sysnet.utcc.ac.th/aparcas/api/get_lat_long_from_event_trans.jsp", function (result1) {

                    for (i = 0; i < result1.length; i++) {

                    var mlat = result1[i].lat;
                    var mlon = result1[i].lon;
                    var uid = result1[i].uid;
                    console.log("call Loopna");
                    postJSON(uid,mlat, mlon);

                  }


                });*/

                $.getJSON("http://sysnet.utcc.ac.th/aparcas/api/getdistrict.jsp?data=d", function(d) {
                    var query = "<li ><a href='#'data-value='2222'>เขตทั้งหมด</a></li>";
                    $("#dropdownD").append(query);
                    for (i = 0; i < d.length; i++) {
                        var query = "<li ><a href='#'data-value='" + d[i].dcode + "'>" + d[i].dname + "</a></li>";
                        $("#dropdownD").append(query);
                    }

                    $(".dropdown-menu li a").click(function() { // show value when click
                        $(this).parents(".dropdown").find('.btn').html($(this).text());
                        $(this).parents(".dropdown").find('.btn').val($(this).data('value'));

                        $("#dropdownS").empty();
                        allS = null;
                        allS = [];
                        $("#sname").text('แขวงทั้งหมด');
                        document.getElementById("sname").value = "2222";
                        var dname = document.getElementById("dname").innerHTML;
                        console.log("dname: " + dname);
                        $(this).parents(".dropdown").find('.btn').html($(this).text());
                        $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
                        var query = "<li ><a href='#'data-value='2222'>แขวงทั้งหมด</a></li>";
                        $("#dropdownS").append(query);

                        $.getJSON("http://sysnet.utcc.ac.th/aparcas/api/getdistrict.jsp?data=s&checkdname=" + dname + "", function(s) {
                            for (i = 0; i < s.length; i++) {

                                var query = "<li ><a href='#'data-value='" + s[i].scode + "'>" + s[i].sname + "</a></li>";
                                $("#dropdownS").append(query);
                                allS.push(s[i].scode);
                            }
                            var grids = "";
                            for (i = 0; i < allS.length; i++) {
                                console.log("AllS: " + allS[i]);
                                grids += "&grids=" + allS[i] + "";
                            }
                            console.log("Grids: http://sysnet.utcc.ac.th/aparcas/api/getGridID.jsp?" + grids);
                            $.getJSON("http://sysnet.utcc.ac.th/aparcas/api/getGridID.jsp?" + grids, function(res3) {
                                AllDID = [];
                                for (i = 0; i < res3.length; i++) {
                                    AllDID.push(res3[i].id);
                                }
                            });
                            $(".dropdown-menu li a").click(function() { // show value when click
                                $(this).parents(".dropdown").find('.btn').html($(this).text());
                                $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
                                var snameI = document.getElementById("sname").innerHTML;
                                var snameV = document.getElementById("sname").value;
                                console.log("snameI: " + snameI + "snameV: " + snameV);

                                $.getJSON("http://sysnet.utcc.ac.th/aparcas/api/getGridID.jsp?grids=" + snameV + "", function(res4) {
                                    console.log("LengthS: " + res4.length);
                                    AllsID = [];
                                    for (i = 0; i < res4.length; i++) {
                                        AllsID.push(res4[i].id);
                                    } //for
                                }); //getJSON
                            }); //onclick
                        }); //getjson

                    }); //onclick

                }); //json
            }); //function



            /*function postJSON(id,lat,lon){


      console.log("PostJSON");
      $.getJSON("https://www.googleapis.com/fusiontables/v1/query?key=AIzaSyD2Wl_1_czaWb9aBDSdMNLlOXMNI9ULibw&sql=SELECT SUB_CODE FROM 1x40iw0b31K2vTT6ZiSUxBWUfBbznoppAtERA7S2G WHERE ST_INTERSECTS(geometry, CIRCLE(LATLNG(" + lat + "," + lon + "),100))", function (result2) {

      var DistrictID = result2.rows[0][0];


      console.log("uid: " + id + " did: " + DistrictID + " lat: " + lat + " lon: " + lon);
      $.ajax({
      url: 'http://sysnet.utcc.ac.th/aparcas/api/update_event_trans.jsp',
      type: 'PUT',
      data: "did=" + DistrictID + "&uid=" + id + "",
      success: function (data) {
      alert('Load was performed.');
    }
  });
});

}*/

            function getNotification(micon, mtype, mdata) {

                $.notify({
                    icon: micon, //icon
                    message: mdata //data

                }, {
                    type: mtype, //type  danger ,warning ,success ,info
                    timer: 2000
                });


            }


            function RemoveMarker() {
                for (i = 0; i < Circles.length; i++) {
                    Circles[i].setMap(null);
                }
                setMarkerAll(null);
                setCircleAll(null);
                markers = [];
                Circles = [];
            }

            function setMarkerAll(map) {
                for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(map);
                }
            }

            function setCircleAll(map) {
                for (var i = 0; i < Circles.length; i++) {
                    Circles[i].setMap(map);
                }
            }





            /* function getDistrictFromLatlng(lat, lng) {

            //console.log('getDistrictFromLatlng lat: ' + lat + " long: "+lng)
            $.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + lat + "," + lng + "&key=AIzaSyAWgbWYxPgHHo-PU4IuhjjZhjh1PXfhYkc", function (result) {


            for (j = 0; j < result.results[0].address_components.length; j++) {
            if (result.results[0].address_components[j].long_name.match(/^เขต.*$/) || result.results[0].address_components[j].long_name.match(/^อำเภอ.*$/)) {
            var myDistrict = result.results[0].address_components[j].long_name;
            var mCutSpace = myDistrict.replace(" ", "");
            // var mCutTitle = myDistrict.replace("เขต ","");
            //var a = mCutSpace+mCutTitle;
            mResult = mCutSpace.valueOf();
            var addText = "กิ่ง";
            if (mResult == "อำเภอสามชัย" || mResult == "อำเภอนาคู" || mResult == "อำเภอพนมดงรัก" || mResult == "อำเภอโนนนารายณ์" || mResult == "อำเภอเนินขาม" || mResult == "อำเภอหนองหิน" || mResult == "อำเภอบึงสามัคคี" || mResult == "อำเภอบัวลาย" ||
            mResult == "อำเภอซับใหญ่" || mResult == "อำเภอศิลาลาด" || mResult == "อำเภอบ้านแฮด" || mResult == "อำเภอพระทองคำ" ||
            mResult == "อำเภอสากเหล็ก" || mResult == "อำเภอบึงนาราง" || mResult == "อำเภอกุดรัง" || mResult == "อำเภอหนองมะโมง" || mResult == "อำเภอสากเหล็ก" || mResult == "อำเภอดงเจริญ" || mResult == "อำเภอเทพารักษ์" || mResult == "อำเภอแคนดง" || mResult == "อำเภอฆ้องชัย" || mResult == "อำเภอเมืองยาง" || mResult == "อำเภอลำทะเมนชัย" || mResult == "อำเภอหนองฮี" || mResult == "อำเภอซำสูง" || mResult == "อำเภอโนนศิลา" || mResult == "อำเภอหนองนาคำ" || mResult == "อำเภอดอนจาน") {
            mResult = addText + mResult;
            }
            if (mResult == "อำเภอปทุมรัตน์") {
            mResult = "อำเภอปทุมรัตต์";
            }
            if (mResult == "อำเภอหนองบุนนาก") {
            mResult = "อำเภอหนองบุญนาก";
            }
            if (mResult == "อำเภอกุฉินารายณ์") {
            mResult = "อำเภอกุฉินารายน์";
            }
            if (mResult == "อำเภอโคกโพธิ์ไชย") {
            mResult = "กิ่งอำเภอโคกโพธิ์ชัย";
            }
            if (mResult == "อำเภอเมืองนครราชสีมา") {
            mResult = "เมืองนครราชสีมา";
            }
            if (mResult == "อำเภอเวียงเก่า") {
            mResult = "อำเภอภูเวียง";
            }
            if (mResult == "อำเภอโพทะเล") {
            mResult = "โพทะเล";
            }

            //console.log('getDistrictFromLatlng lat: ' + lat + " long: "+lng)
            //console.log("test: "  +mResult);
            getDistrictIDFromDistrictName(mResult);

            }
            }



            });

            }
            */

            function DatePickResponse(dateText) {
                var Day = dateText.substr(0, 2);
                var Month = dateText.substr(3, 2);
                var Year = dateText.substr(6, 7);
                var result = Year + "-" + Month + "-" + Day;
                return result;
            }

            //for test on url
            //https://www.googleapis.com/fusiontables/v2/query?sql=SELECT CCA_2 FROM17Vj_x8KaduQcuxi_C0M6teVPKoId_7qQyyJC_zRs WHERE NL_NAME_2 = 'อำเภอท่าตูม'&key=AIzaSyAWgbWYxPgHHo-PU4IuhjjZhjh1PXfhYkc
            function getDistrictIDFromDistrictName(name) {
                /* $.getJSON("https://www.googleapis.com/fusiontables/v2/query?sql="+
  "SELECT CCA_2 "+
  "FROM 17Vj_x8KaduQcuxi_C0M6teVPKoId_7qQyyJC_zRs "+
  "WHERE NL_NAME_2 = '"+name+"'"+
  "&key=AIzaSyAWgbWYxPgHHo-PU4IuhjjZhjh1PXfhYkc",function(result){

  var str = result.rows+"";
  var res = str.substr(0,4);

  $.post("http://sysnet.utcc.ac.th:8161/aparcas/api/SetDistrict2.jsp",
  {
  id : res,
  name: name,
  province :
  co: co,
  no2: no2,
  o3: o3,
  so2:so2,
  pm25:pm25,
  radio: radio,
  timestamp: time


},

function(data, status){
alert("Data: " + data + "\nStatus: " + status);
}); */

                /*$.ajax({
                type: "POST",
                contentType: "charset=utf-8",
                url: 'http://sysnet.utcc.ac.th:8161/aparcas/api/District2.jsp',
                data: {
                id : res,
                name: name,
                co: co,
                no2: no2,
                o3: o3,
                so2:so2,
                pm25:pm25,
                radio: radio,
                timestamp: time
                }
                });*/

                // });


            }


            /* function showDetail(lat, lng) {
            //getDistrictFromLatlng(lat, lng);
            console.log("Lat: " + lat, " long: " + lng);
            console.log("District: " + mResult);

            }*/

            function getIconMarker(number) {

                console.log("getICONmarker: " + number);
                if (number > 300) {
                    return 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'; //red
                }
                if (number > 201) {
                    return 'http://maps.google.com/mapfiles/ms/icons/orange-dot.png'; //orange
                }
                if (number > 100) {
                    return 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png'; //yellow
                }
                if (number > 51) {
                    return 'http://maps.google.com/mapfiles/ms/icons/green-dot.png' //green
                }
                if (number > 0) {
                    return 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'; //blue
                }
                return null;
            }

            function getfillColor(number) {


                if (number > 300) {
                    return "#ff4d4d"; //red
                }
                if (number > 201) {
                    return "#ff944d"; //orange
                }
                if (number > 100) {
                    return "#ffff4d"; //yellow
                }
                if (number > 51) {
                    return "#4dff88" //green
                } else {
                    return "#4d4dff"; //blue

                }
                return null;
            }

            function getStrokeColor(number) {



                if (number > 300) {
                    return "#ff0000"; //red
                }
                if (number > 201) {
                    return "#ff6600"; //orange
                }
                if (number > 100) {
                    return "#ffff00"; //yellow
                }
                if (number > 51) {
                    return "#00cc00" //green
                } else {
                    return "#0066ff"; //blue
                }
                return null;
            }



            $("#clear").click(function() {
                RemoveMarker();
                getNotification("pe-7s-smile", "success", "<b>Success</b>");
            });

            function getColorMarker(radio) {

                var mRadio = parseInt(radio);

                if (radio > 1) {
                    return "icon/marker_rad_red.png";
                }
                if (radio > 0.5) {
                    return "icon/marker_rad_yellow.png";
                }
                if (radio < 0.5) {
                    return "icon/marker_rad_green.png";
                }
                return null;

            }
</script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>





<script src="bower_components/bootstrap/dist/js/bootstrap-notify.js"></script>

<script src="bower_components/bootstrap-waitingfor/build/bootstrap-waitingfor.js"></script>


<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWgbWYxPgHHo-PU4IuhjjZhjh1PXfhYkc&callback=initMap" type="text/javascript"></script>



</html>
